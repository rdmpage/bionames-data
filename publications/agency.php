<?php

// Get DOI agency for a set of DOI prefixes

// get list of DOIs, one per prefix from doi_by_prefix.php


require_once (dirname(dirname(__FILE__)) . '/lib.php');



$dois=array();

$dois=array(
"10.5354/0717-8883.1863.19855",
"10.1080/00173137409429902",
"10.3406/jatba.1925.4331",
"10.33736/bjrst.593.2017",
"10.22092/ijb.2017.107596.1132",
"10.7677/ynzwyj201312041");

$dois=array(
"10.1144/0262-821X10-026",
"10.5479/si.00810266.10.1",
"10.1111/1475-4983.00071",
"10.2307/1374824",
"10.1007/978-3-642-10311-7_4",
"10.1080/00034983.1910.11685702",
"10.2475/ajs.239.4.286",
"10.1163/001121610X546698",
"10.3853/j.0067-1967.12.1966.425",
"10.1071/AJZS002",
"10.1130/0-8137-2316-7",
"10.21411/CBM.A.14C738E5",
"10.1093/aesa/10.4.323",
"10.11369/jji1950.1.73",
"10.1016/0011-7471(73)90059-4",
"10.1038/078569b0",
"10.1002/(SICI)1099-1034(199703)32:1<69::AID-GJ734>3.0.CO;2-Q",
"10.2476/asjaa.11.5",
"10.1073/pnas.0606937104",
"10.21248/contrib.entomol.10.3-4.419-434",
"10.1051/acarologia/20111992",
"10.1590/0001-3765201820180661",
"10.1155/1910/71484",
"10.5169/SEALS-161430",
"10.5962/bhl.part.12420",
"10.3354/dao017009",
"10.2973/dsdp.proc.11.110.1972",
"10.1017/jpa.2015.34",
"10.1139/cjes-2012-0119",
"10.3406/linly.1939.9451",
"10.4039/Ent1001100-10",
"10.4102/koedoe.v37i1.327",
"10.15914/j.cnki.wykx.1992.00.004",
"10.1039/np9920900001",
"10.1006/cres.1997.0114",
"10.2108/zs140128",
"10.13130/2039-4942/5248",
"10.1046/j.0031-0239.2003.00338.x",
"10.11606/issn.2176-7793.v16i2p321-630",
"10.1515/9783110824445",
"10.2149/tmh.32.311",
"10.1023/A:1003199031726",
"10.3989/graellsia.1995.v51.i0.404",
"10.1076/aqin.21.1.19.4544",
"10.3969/j.issn.1000-0739.1998.04.003",
"10.2982/0012-8317(1997)86[1:ACIT]2.0.CO;2",
"10.1206/0003-0082(2001)328<0001:LDCTEE>2.0.CO;2",
"10.3733/hilg.v28n07p193",
"10.1127/0077-7749/2007/0243-0127",
"10.1649/0010-065X(2000)054[0090:ABONFA]2.0.CO;2",
"10.2463/mrms.8.47",
"10.1603/0013-8746(2000)093[0185:SOTNWN]2.0.CO;2",
"10.1666/0022-3360(2000)074<0224:JKANGA>2.0.CO;2",
"10.24199/j.mmv.2000.58.4",
"10.5380/abpr.v16i0.813",
"10.1029/AR014",
"10.1671/0272-4634(2000)020[0422:NTSEFT]2.0.CO;2",
"10.14411/eje.2001.016",
"10.1636/0161-8202(2001)029[0021:RNDLED]2.0.CO;2",
"10.1560/0UQA-DF2T-M3U8-V80Y",
"10.5194/fr-2-159-1999",
"10.1664/0028-7199(2001)109[0214:AROTGP]2.0.CO;2",
"10.1079/BER2001112",
"10.2113/0320135",
"10.1078/0044-5231-00097",
"10.22179/revmacn.14.205",
"10.1126/science.1069397",
"10.1655/0018-0831(2002)058[0327:EDOSAH]2.0.CO;2",
"10.1643/0045-8511(2002)002[0755:TNSOPP]2.0.CO;2",
"10.1635/0097-3157(2002)152[0045:AVICMS]2.0.CO;2",
"10.11646/palaeoentomology.2.2.4",
"10.3161/000345408783897806",
"10.1651/0278-0372(2000)020[0715:TXCDBF]2.0.CO;2",
"10.1645/0022-3395(2003)089[0124:ANGONN]2.0.CO;2",
"10.4067/S0716-078X2003000100011",
"10.20695/edaphologia.72.0_1",
"10.1556/038.51.2016.1.10",
"10.1353/psc.2003.0023",
"10.1099/ijs.0.009621-0",
"10.1665/034.021.0102",
"10.1654/1525-2647-85.1.73",
"10.2317/0022-8567-89.4.345",
"10.1644/06-MAMM-A-090R.1",
"10.2988/0006-324X(2005)118[74:KBANGA]2.0.CO;2",
"10.2300/acari.14.13",
"10.11609/jott.1910.8.2.8526-8527",
"10.3409/000000006783995346",
"10.2517/1342-8144-14.2.119",
"10.1186/1471-2148-13-203",
"10.2216/04-103.1",
"10.2478/aemnp-2018-0022",
"10.3852/08-113",
"10.1660/0022-8443(2006)109[191:DWIDAC]2.0.CO;2",
"10.2992/007.078.0201",
"10.3157/0002-8320-133.3.297",
"10.4003/0740-2783-22.1.119",
"10.1525/california/9780520098596.003.0022",
"10.18475/cjos.v43i1.a11",
"10.4081/BollettinoSEI.2012.7",
"10.4001/003.018.0206",
"10.3140/bull.geosci.1575",
"10.1670/06-103.1",
"10.3099/0027-4100(2007)159[145:NEFLPP]2.0.CO;2",
"10.5635/ased.2017.33.1.056",
"10.1673/031.007.5101",
"10.4289/0013-8797-110.4.940",
"10.1653/0015-4040(2007)90[674:ROTBDG]2.0.CO;2",
"10.5038/1827-806x.8.1.18",
"10.1303/aez.23.150",
"10.3996/nafa.3.0006",
"10.2183/pjab1912.19.205",
"10.5575/geosoc.42.483",
"10.1098/rsbl.2013.1067",
"10.1086/279477",
"10.3897/afrinvertebr.60.32652",
"10.3956/0031-0603-88.2.154",
"10.3377/1562-7020(2008)43[16:DANFOM]2.0.CO;2",
"10.4202/app.00003.2013",
"10.5733/afin.049.0204",
"10.18474/0749-8004-44.1.37",
"10.5252/g2009n4a909",
"10.1371/journal.pone.0006577",
"10.4002/040.053.0104",
"10.2994/057.005.0205",
"10.15517/rgac.v0i42.4170",
"10.7589/0090-3558-24.3.538",
"10.1159/000155853",
"10.26028/cybium/2011-351-005",
"10.3724/SP.J.1245.2010.00022",
"10.4311/jcks2010lsc0147",
"10.11158/saa.17.1.12",
"10.5710/amgh.01.07.2014.2759",
"10.2298/ABS1202709C",
"10.3752/cjai.2012.21",
"10.12782/sd.17.1.049",
"10.1134/s0031030110050126",
"10.5852/ejt.2012.34",
"10.3158/2158-5520-5.1.90",
"10.5343/bms.2013.1014",
"10.12651/jsr.2013.2.1.015",
"10.1896/052.026.0102",
"10.3374/014.054.0205",
"10.1676/12-136.1",
"10.18268/bsgm2013v65n2a6",
"10.7868/s0044513414010073",
"10.3398/064.074.0105",
"10.1642/auk-13-245.1",
"10.18473/lepi.69i4.a7",
"10.5324/cjcr.v0i29.2113",
"10.11865/zs.20150112",
"10.23885/1814-3326-2013-9-1-43-46",
"10.4267/2042/54151",
"10.16970/ted.77822",
"10.18195/issn.0312-3162.29(2).2014.141-148",
"10.12976/jib/2015.3.10",
"10.14712/23361964.2015.82",
"10.5027/andgeoV42n1-a04",
"10.12692/ijb/7.1.49-57",
"10.3906/zoo-1409-38",
"10.5281/zenodo.35388",
"10.18348/opzool.2015.1.3",
"10.12681/mms.1333",
"10.17109/AZH.62.1.1.2016",
"10.17707/agricultforest.62.1.01",
"10.4154/gc.2016.17",
"10.15381/rpb.v22i3.11432",
"10.17112/FoliaEntHung.2014.75.21",
"10.18476/sbna.v9.a13",
"10.3726/978-3-0351-0858-3/20",
"10.17161/jom.v0i36.4777",
"10.21077/ijf.2017.64.2.69298-01",
"10.13156/arac.2017.17.5.229",
"10.7717/peerj.1778",
"10.18353/crustacea.46.0_25",
"10.18590/euscorpius.2017.vol2017.iss243.1",
"10.26879/832",
"10.32475/bsef_2011",
"10.31184/m00138908.1543.3924",
"10.4138/atlgeol.2018.006",
"10.21638/11701/spbu03.2017.402",
"10.3390/d10020037",
"10.15298/arthsel.28.1.15",
"10.29041/strat.14.1-4.457-474",
"10.14241/asgp.2018.017",
"10.32857/bap.2018.395.09",
"10.12657/folmal.027.001",
"10.15625/0866-7160/v33n4.773",
"10.19111/bulletinofmre.494620",
"10.25221/fee.375.4",
"10.19263/redia-101.18.17",
"10.25226/bboc.v139i2.2019.a7",
"10.30836/igs.1025-6814.2016.4.96365",
"10.31610/zsr/2018.27.2.229",
"10.21684/0132-8077-2019-27-2-193-208",
"10.4314/mcd.v14i1.5",
"10.35249/rche.45.4.19.14",
"10.3329/jbcbm.v5i2.44917",
"10.22370/rbmo.2019.54.3.2015",
"10.18785/grr.0803.07",
"10.1577/1548-8667(1995)007<0038:AMNSDM>2.3.CO;2",
"10.1674/0003-0031(2002)148[0061:AROMPA]2.0.CO;2",
"10.5358/hsj.22.51",
"10.4095/102333",
"10.3347/kjp.1984.22.1.96",
"10.1177/0022009407075547",
"10.4038/cjsbs.v43i1.6850",
"10.3958/059.039.0406",
"10.13102/sociobiology.v62i2.163-174",
"10.5431/aramit4906",
"10.3800/pbr.11.37",
"10.2984/71.3.7",
"10.30963/aramit5510",
"10.3389/fmars.2017.00291",
"10.20341/gb.2019.008",
"10.3109/10408419209113519",
"10.3739/rikusui.59.367",
"10.1661/0026-2803(2003)049[0027:JMMDOA]2.0.CO;2",
"10.1360/03tb9148",
"10.3106/1348-6160(2006)31[47:ANSORS]2.0.CO;2",
"10.2174/1874421400701010007",
"10.3176/earth.2009.4.08",
"10.5402/2011/391796",
"10.4072/rbp.2011.2.03",
"10.4467/16890027AP.11.023.0023",
"10.1899/12-026.1",
"10.6119/JMST-013-1219-10",
"10.12944/cwe.9.1.29",
"10.5209/rev_jige.2015.v41.n1.48652",
"10.12980/jclm.3.2015j5-36",
"10.3160/soca-115-01-72-80.1",
"10.9784/LEB4(1)Mercado.01",
"10.18681/pjn.v34.i02.p109",
"10.17111/fragmpalhung.2016.33.3",
"10.21608/eajbsa.2015.12867",
"10.22201/ib.20078706e.2018.2.2026",
"10.7306/gq.1432",
"10.21307/jofnem-2018-023",
"10.31396/biodiv.jour.2019.10.2.71.80",
"10.33307/entomon.v44i1.424",
"10.23928/foldt.kozl.2019.149.2.149",
"10.37828/em.2019.24.1",
"10.4236/ojg.2019.912098",
"10.3105/1881-1019(2007)26[65:ANSOFA]2.0.CO;2",
"10.5424/sjar/20110901-308-10",
"10.14203/treubia.v42i0.565",
"10.23902/trkjnat.411785",
"10.4000/quaternaire.9957",
"10.18470/1992-1098-2011-3-65-69",
"10.18563/journal.m3.103",
"10.1292/jvms.56.707",
"10.15446/caldasia.v36n1.43900",
"10.3147/jsfp.49.181",
"10.1128/aem.00160-15",
"10.11680/entomotax.2015017",
"10.11853/j.issn.1003.4692.2015.03.021",
"10.11984/j.issn.1000-7083.20150275",
"10.21068/c2017.v18n01a11",
"10.9710/kjm.2018.34.2.121",
"10.21829/azm.2018.3412145",
"10.17082/j.2204-1478.61.2018.2018-11",
"10.21685/1680-0826-2019-13-3-2",
"10.7203/sjp.33.1.13248",
"10.2989/025776102784528411",
"10.1501/Commuc3_0000000013",
"10.3356/JRR-08-18.1",
"10.4025/actascibiolsci.v31i3.4917",
"10.1108/00330330810892677",
"10.31611/ch.49",
"10.18257/raccefyn.239",
"10.1894/0038-4909(2003)048<0700:NSOSMR>2.0.CO;2",
"10.3923/je.2007.404.424",
"10.3750/AIP2008.38.1.04",
"10.7550/rmb.31955",
"10.7755/fb.111.2.2",
"10.5007/2175-7925.2016v29n1p37",
"10.5958/0974-4576.2016.00021.9",
"10.5604/01.3001.0010.5659",
"10.33338/ef.79903",
"10.5937/zaspri1702025p",
"10.15407/ukrbotj72.02.147",
"10.33800/nc.vi15.210",
"10.1650/7596",
"10.7882/az.1982.001",
"10.17159/2305-7963/2016/v12n1a1",
"10.14198/cdbio.2016.51.02",
"10.5735/086.056.0113",
"10.24272/j.issn.2095-8137.2020.033",
"10.11137/2019_2_437_443",
"10.1084/jem.44.3.307",
"10.5354/0717-8883.1897.21193",
"10.14409/favecv.v6i1/2.1440",
"10.12933/therya-14-209",
"10.12741/ebrasilis.v9i3.589",
"10.2744/ccb-1292.1",
"10.33451/florafauna.v25i1pp53-58",
"10.32912/ram.2019.54.4",
"10.1055/s-1986-31766",
"10.5248/114.7",
"10.6001/biologija.v64i2.3735",
"10.7554/elife.50465",
"10.2983/0730-8000(2008)27[15:TNSOTF]2.0.CO;2",
"10.5897/jen12.005",
"10.3301/ijg.2013.10",
"10.33256/hj29.1.2336",
"10.35929/rsz.0013",
"10.20302/nc.2019.28.25",
"10.11238/jmammsocjapan1987.15.47",
"10.5152/tpd.2013.10",
"10.2987/08-5751.1",
"10.3318/IJES.2010.28.1",
"10.5869/fc.2013.v19.103",
"10.14293/s2199-1006.1.sor-geo.cley0wb.v1",
"10.1021/om00024a033",
"10.4013/nbc.2015.103.01",
"10.14446/amnp.2013.065",
"10.17582/journal.pjz/2018.50.1.325.328",
"10.1034/j.1600-0412.1999.780903.x",
"10.17811/tdg.36.2016.311-346",
"10.3201/eid0505.990506",
"10.1094/PHYTO.2003.93.9.1093",
"10.17850/njg97-2-03",
"10.1656/058.010.0203",
"10.1354/vp.42-5-589",
"10.2110/palo.2009.p09-112r",
"10.1537/ase.170322",
"10.5377/ceiba.v55i1.5452",
"10.24275/uam/izt/dcbs/hidro/2018v28n3/aceves",
"10.3391/ai.2010.5.4.01",
"10.1210/jc.2009-0370",
"10.5123/s1981-81142008000200001",
"10.12714/egejfas.2019.36.3.01",
"10.2460/javma.2003.222.1526",
"10.7601/mez.62.31",
"10.4404/hystrix-22.1-4473",
"10.11598/btb.2014.21.2.3",
"10.16380/j.kcxb.2015.09.011",
"10.3856/vol45-issue1-fulltext-21",
"10.30906/1026-2296-2019-26-2-111-122",
"10.1109/94.708264",
"10.3759/tropics.1.49",
"10.13128/Acta_Herpetol-1879	",
"10.1037/0033-2909.130.3.392",
"10.3101/1098-7096-72.1.39",
"10.11813/j.issn.0254-5853.2013.5.0459",
"10.5327/z2317-48892013000100003",
"10.33265/polar.v38.3325",
"10.4490/algae.2007.22.1.023",
"10.1672/1536-2442(2002)002[0001:NRNSAU]2.0.CO;2",
"10.1089/vbz.2005.5.72",
"10.3321/j.issn:1000-2030.2007.04.015",
"10.5656/KSAE.2011.06.0.23",
"10.14430/arctic4329",
"10.7872/crya/v38.iss1.2017.3",
"10.24193/subbbiol.2018.1",
"10.15450/rmm141001",
"10.29077/bol/113/ce04_hava",
"10.25085/rsea.790101",
"10.2337/diacare.19.3.257",
"10.1179/136485905x24210",
"10.17087/jbnhs/2015/v112i2/104927",
"10.15671/hjbc.2018.265",
"10.1158/1078-0432.CCR-1160-3",
"10.11369/jji1950.1.73",
"10.21199/wb47.4.1",
"10.14258/abs.v5.i2.5783",
"10.5134/175619",
"10.18520/cs/v113/i11/2127-2133",
"10.31017/cdh.2019.(2019-004)",
"10.1669/0883-1351(2002)017<0435:LRCFTM>2.0.CO;2",
"10.11160/bah.13011",
"10.4036/iis.2004.99",
"10.25249/0375-7536.2009394705716",
"10.16380/j.kcxb.2015.09.011",
"10.3799/dqkx.2015.065",
"10.17957/ijab/15.0423",
"10.26496/bjz.2018.18",
"10.9795/bullgsj.70.163",
"10.2302/kjm.58.50",
"10.3725/jjn.37.63",
"10.4116/jaqua.4.49",
"10.4269/ajtmh.14-0774",
"10.26749/rstpp.150.2.43");

$count = 1;

foreach ($dois as $doi)
{
	echo "-- $doi\n";
	
	$prefix = substr($doi, 0, strpos($doi, "/"));
	
	//$url = 'http://api.crossref.org/works/' . $doi . '/agency';
	
	$url = 'http://doi.org/ra/' . $doi;
	
	$json = get($url);
	
	//echo $url . "\n";
	//echo $json;
	
	if ($json != '')
	{
		$obj = json_decode($json);
		
		if (isset($obj->message->agency))
		{
			echo "-- $prefix " . $obj->message->agency->id . "\n";
			
			//echo 'UPDATE names_indexfungorum SET doi_agency="' . $obj->message->agency->id . '" WHERE doi LIKE "' . $prefix . '%";' . "\n";
			echo 'UPDATE names SET doi_agency="' . $obj->message->agency->id . '" WHERE doi LIKE "' . $prefix . '%";' . "\n";
		}
		
		if (isset($obj[0]->RA))
		{
			echo "-- $prefix " . $obj[0]->RA . "\n";
			
			//echo 'UPDATE names_indexfungorum SET doi_agency="' . $obj->message->agency->id . '" WHERE doi LIKE "' . $prefix . '%";' . "\n";
			echo 'UPDATE names SET doi_agency="' . strtolower($obj[0]->RA) . '" WHERE doi LIKE "' . $prefix . '%";' . "\n";
		}
		
	}
	
	if (($count++ % 10) == 0)
	{
		$rand = rand(1000000, 3000000);
		echo '-- sleeping for ' . round(($rand / 1000000),2) . ' seconds' . "\n";
		usleep($rand);
	}
	
}	

?>